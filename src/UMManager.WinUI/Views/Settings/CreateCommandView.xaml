<?xml version="1.0" encoding="utf-8" ?>
<UserControl
    x:Class="UMManager.WinUI.Views.Settings.CreateCommandView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:controls1="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:controls2="using:UMManager.WinUI.Views.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:UMManager.WinUI.Views.Settings"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>


        <StackPanel Margin="0,0,0,16">
            <TextBlock FontSize="18" Text="创建命令" />
            <TextBox
                MinWidth="300"
                HorizontalAlignment="Left"
                Header="* 命令名称："
                PlaceholderText="命令显示名称（必填）"
                Text="{x:Bind ViewModel.CommandDisplayName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
        </StackPanel>



        <Grid Grid.Row="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition />
            </Grid.RowDefinitions>

            <controls:Segmented
                HorizontalAlignment="Center"
                SelectedIndex="0"
                SelectionMode="Single">
                <controls:SegmentedItem Content="自定义命令" />
                <controls:SegmentedItem
                    Content="自定义链式命令"
                    IsEnabled="False"
                    ToolTipService.ToolTip="暂未实现" />
            </controls:Segmented>


            <controls1:SwitchPresenter Grid.Row="1" Value="自定义命令">
                <controls1:Case Value="自定义命令">
                    <ScrollViewer>

                        <StackPanel Spacing="8">
                            <controls2:FolderSelector
                                Title="* 可执行文件"
                                BrowseCommand="{x:Bind ViewModel.SelectExecutableCommand}"
                                PlaceHolderText="必须位于 $PATH 中，或填写可执行文件的绝对路径（必填）"
                                SelectedFolderValue="{x:Bind ViewModel.Command, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                            <controls2:FolderSelector
                                Title="工作目录"
                                BrowseCommand="{x:Bind ViewModel.SelectWorkingDirectoryCommand}"
                                Footer="{x:Bind ViewModel.EffectiveWorkingDirectory, Mode=OneWay}"
                                IsEnabled="{x:Bind ViewModel.CanEditWorkingDirectory, Mode=OneWay}"
                                PlaceHolderText="手动指定路径时，该文件夹必须存在"
                                SelectedFolderValue="{x:Bind ViewModel.WorkingDirectory, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                            <StackPanel>
                                <TextBox
                                    Header="参数"
                                    PlaceholderText="传递给可执行文件的参数"
                                    Text="{x:Bind ViewModel.Arguments, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                <TextBlock IsTextSelectionEnabled="True" Text="当命令针对文件系统对象执行（例如皮肤/模组文件夹）时，{{TargetPath}} 会被替换为实际路径。" />
                            </StackPanel>


                            <StackPanel>
                                <CheckBox
                                    Content="UMManager 退出时结束进程"
                                    IsChecked="{x:Bind ViewModel.KillProcessOnMainAppExit, Mode=TwoWay}"
                                    ToolTipService.ToolTip="勾选后，UMManager 退出时会结束该进程" />
                                <CheckBox
                                    Command="{x:Bind ViewModel.ToggleRunAsAdminCommand}"
                                    Content="以管理员身份运行"
                                    IsChecked="{x:Bind ViewModel.RunAsAdmin, Mode=TwoWay}"
                                    ToolTipService.ToolTip="以管理员身份启动可执行文件" />
                                <CheckBox
                                    Command="{x:Bind ViewModel.ToggleUseShellExecuteCommand}"
                                    Content="使用 Shell 执行"
                                    IsChecked="{x:Bind ViewModel.UseShellExecute, Mode=TwoWay}"
                                    IsEnabled="{x:Bind ViewModel.CanToggleUseShellExecute, Mode=OneWay}"
                                    ToolTipService.ToolTip="通过操作系统启动可执行文件" />
                                <CheckBox
                                    Content="创建窗口"
                                    IsChecked="{x:Bind ViewModel.CreateWindow, Mode=TwoWay}"
                                    IsEnabled="False"
                                    ToolTipService.ToolTip="勾选后将在外部窗口中运行" />
                            </StackPanel>

                        </StackPanel>
                    </ScrollViewer>

                </controls1:Case>
            </controls1:SwitchPresenter>

        </Grid>

        <StackPanel Grid.Row="2" Spacing="16">
            <TextBox
                Header="将要执行的命令："
                IsReadOnly="True"
                Text="{x:Bind ViewModel.CommandPreview, Mode=OneWay}" />
            <Button
                Command="{x:Bind ViewModel.CreateCommandCommand}"
                Content="保存命令"
                Style="{ThemeResource AccentButtonStyle}" />
        </StackPanel>


    </Grid>
</UserControl>
